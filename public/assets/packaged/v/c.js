(()=>{var t,e,r=Object.create,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,h=(t,e,h)=>(h=null!=t?r(n(t)):{},((t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(const r of i(e))!a.call(t,r)&&void 0!==r&&o(t,r,{get:()=>e[r],enumerable:!(n=s(e,r))||n.enumerable});return t})(!e&&t&&t.__esModule?h:o(h,"default",{value:t,enumerable:!0}),t)),c=(t=(t,e)=>{var r,o="object"==typeof Reflect?Reflect:null,s=o&&"function"==typeof o.apply?o.apply:(t,e,r)=>Function.prototype.apply.call(t,e,r);r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?t=>Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)):t=>Object.getOwnPropertyNames(t);var i=Number.isNaN||(t=>t!=t);function n(){n.init.call(this)}e.exports=n,e.exports.once=function(t,e){return new Promise(((r,o)=>{function s(r){t.removeListener(e,i),o(r)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",s),r([].slice.call(arguments))}m(t,e,i,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,s)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var a=10;function h(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function l(t,e,r,o){var s,i,n;if(h(r),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),n=i[e]),void 0===n)n=i[e]=r,++t._eventsCount;else if("function"==typeof n?n=i[e]=o?[r,n]:[n,r]:o?n.unshift(r):n.push(r),(s=c(t))>0&&n.length>s&&!n.warned){n.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=n.length,function(t){console&&console.warn&&console.warn(t)}(a)}return t}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(t,e,r){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},s=d.bind(o);return s.listener=r,o.wrapFn=s,s}function p(t,e,r){var o=t._events;if(void 0===o)return[];var s=o[e];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(s):g(s,s.length)}function w(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(t,e){for(var r=new Array(e),o=0;o<e;++o)r[o]=t[o];return r}function m(t,e,r,o){if("function"==typeof t.on)o.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function s(i){o.once&&t.removeEventListener(e,s),r(i)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:()=>a,set:t=>{if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),n.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var n;if(e.length>0&&(n=e[0]),n instanceof Error)throw n;var a=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw a.context=n,a}var h=i[t];if(void 0===h)return!1;if("function"==typeof h)s(h,this,e);else{var c=h.length,l=g(h,c);for(r=0;r<c;++r)s(l[r],this,e)}return!0},n.prototype.addListener=function(t,e){return l(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return l(this,t,e,!0)},n.prototype.once=function(t,e){return h(e),this.on(t,u(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return h(e),this.prependListener(t,u(this,t,e)),this},n.prototype.removeListener=function(t,e){var r,o,s,i,n;if(h(e),void 0===(o=this._events))return this;if(void 0===(r=o[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===e||r[i].listener===e){n=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,s),1===r.length&&(o[t]=r[0]),void 0!==o.removeListener&&this.emit("removeListener",t,n||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,r,o;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var s,i=Object.keys(r);for(o=0;o<i.length;++o)"removeListener"!==(s=i[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this},n.prototype.listeners=function(t){return p(this,t,!0)},n.prototype.rawListeners=function(t){return p(this,t,!1)},n.listenerCount=(t,e)=>"function"==typeof t.listenerCount?t.listenerCount(e):w.call(t,e),n.prototype.listenerCount=w,n.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},()=>(e||t(e={exports:{}},e),e.exports)),l=h(c(),1),d=class{#t;#e;constructor(t={},e=null,r=null){this.#t=!1,this.#e=null,this.data=t,this.target=e,this.that=r}get intercepted(){return this.#t}get returnValue(){return this.#e}respondWith(t){this.#e=t,this.#t=!0}},u=class extends l.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.document=this.window.document,this.Document=this.window.Document||{},this.DOMParser=this.window.DOMParser||{},this.docProto=this.Document.prototype||{},this.domProto=this.DOMParser.prototype||{},this.title=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"title"),this.cookie=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"cookie"),this.referrer=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"referrer"),this.domain=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"domain"),this.documentURI=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"documentURI"),this.write=this.docProto.write,this.writeln=this.docProto.writeln,this.querySelector=this.docProto.querySelector,this.querySelectorAll=this.docProto.querySelectorAll,this.parseFromString=this.domProto.parseFromString,this.URL=t.nativeMethods.getOwnPropertyDescriptor(this.docProto,"URL")}overrideParseFromString(){this.ctx.override(this.domProto,"parseFromString",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({string:o,type:s},t,e);return this.emit("parseFromString",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.string,i.data.type)}))}overrideQuerySelector(){this.ctx.override(this.docProto,"querySelector",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({selectors:o},t,e);return this.emit("querySelector",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.selectors)}))}overrideDomain(){this.ctx.overrideDescriptor(this.docProto,"domain",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getDomain",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);return this.emit("setDomain",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.value)}})}overrideReferrer(){this.ctx.overrideDescriptor(this.docProto,"referrer",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("referrer",r),r.intercepted?r.returnValue:r.data.value}})}overrideCreateTreeWalker(){this.ctx.override(this.docProto,"createTreeWalker",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o,s=4294967295,i,n]=r,a=new d({root:o,show:s,filter:i,expandEntityReferences:n},t,e);return this.emit("createTreeWalker",a),a.intercepted?a.returnValue:a.target.call(a.that,a.data.root,a.data.show,a.data.filter,a.data.expandEntityReferences)}))}overrideWrite(){this.ctx.override(this.docProto,"write",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[...o]=r,s=new d({html:o},t,e);return this.emit("write",s),s.intercepted?s.returnValue:s.target.apply(s.that,s.data.html)})),this.ctx.override(this.docProto,"writeln",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[...o]=r,s=new d({html:o},t,e);return this.emit("writeln",s),s.intercepted?s.returnValue:s.target.apply(s.that,s.data.html)}))}overrideDocumentURI(){this.ctx.overrideDescriptor(this.docProto,"documentURI",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("documentURI",r),r.intercepted?r.returnValue:r.data.value}})}overrideURL(){this.ctx.overrideDescriptor(this.docProto,"URL",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("url",r),r.intercepted?r.returnValue:r.data.value}})}overrideCookie(){this.ctx.overrideDescriptor(this.docProto,"cookie",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getCookie",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);return this.emit("setCookie",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.value)}})}overrideTitle(){this.ctx.overrideDescriptor(this.docProto,"title",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getTitle",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);return this.emit("setTitle",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.value)}})}},p=u,w=h(c(),1),g=class extends w.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Audio=this.window.Audio,this.Element=this.window.Element,this.elemProto=this.Element?this.Element.prototype:{},this.innerHTML=t.nativeMethods.getOwnPropertyDescriptor(this.elemProto,"innerHTML"),this.outerHTML=t.nativeMethods.getOwnPropertyDescriptor(this.elemProto,"outerHTML"),this.setAttribute=this.elemProto.setAttribute,this.getAttribute=this.elemProto.getAttribute,this.removeAttribute=this.elemProto.removeAttribute,this.hasAttribute=this.elemProto.hasAttribute,this.querySelector=this.elemProto.querySelector,this.querySelectorAll=this.elemProto.querySelectorAll,this.insertAdjacentHTML=this.elemProto.insertAdjacentHTML,this.insertAdjacentText=this.elemProto.insertAdjacentText}overrideQuerySelector(){this.ctx.override(this.elemProto,"querySelector",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({selectors:o},t,e);return this.emit("querySelector",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.selectors)}))}overrideAttribute(){this.ctx.override(this.elemProto,"getAttribute",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("getAttribute",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.elemProto,"setAttribute",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,value:s},t,e);return this.emit("setAttribute",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)})),this.ctx.override(this.elemProto,"hasAttribute",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("hasAttribute",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.elemProto,"removeAttribute",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("removeAttribute",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)}))}overrideAudio(){this.ctx.override(this.window,"Audio",((t,e,r)=>{if(!r.length)return new t(...r);const[o]=r,s=new d({url:o},t,e);return this.emit("audio",s),s.intercepted?s.returnValue:new s.target(s.data.url)}),!0)}overrideHtml(){this.hookProperty(this.Element,"innerHTML",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getInnerHTML",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);if(this.emit("setInnerHTML",o),o.intercepted)return o.returnValue;t.call(e,o.data.value)}}),this.hookProperty(this.Element,"outerHTML",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getOuterHTML",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);if(this.emit("setOuterHTML",o),o.intercepted)return o.returnValue;t.call(e,o.data.value)}})}overrideInsertAdjacentHTML(){this.ctx.override(this.elemProto,"insertAdjacentHTML",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({position:o,html:s},t,e);return this.emit("insertAdjacentHTML",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.position,i.data.html)}))}overrideInsertAdjacentText(){this.ctx.override(this.elemProto,"insertAdjacentText",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({position:o,text:s},t,e);return this.emit("insertAdjacentText",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.position,i.data.text)}))}hookProperty(t,e,r){if(!t)return!1;if(this.ctx.nativeMethods.isArray(t)){for(const o of t)this.hookProperty(o,e,r);return!0}const o=t.prototype;return this.ctx.overrideDescriptor(o,e,r),!0}},m=g,v=h(c(),1),y=class extends v.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Node=t.window.Node||{},this.nodeProto=this.Node.prototype||{},this.compareDocumentPosition=this.nodeProto.compareDocumentPosition,this.contains=this.nodeProto.contains,this.insertBefore=this.nodeProto.insertBefore,this.replaceChild=this.nodeProto.replaceChild,this.append=this.nodeProto.append,this.appendChild=this.nodeProto.appendChild,this.removeChild=this.nodeProto.removeChild,this.textContent=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"textContent"),this.parentNode=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"parentNode"),this.parentElement=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"parentElement"),this.childNodes=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"childNodes"),this.baseURI=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"baseURI"),this.previousSibling=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"previousSibling"),this.ownerDocument=t.nativeMethods.getOwnPropertyDescriptor(this.nodeProto,"ownerDocument")}overrideTextContent(){this.ctx.overrideDescriptor(this.nodeProto,"textContent",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getTextContent",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);if(this.emit("setTextContent",o),o.intercepted)return o.returnValue;t.call(e,o.data.value)}})}overrideAppend(){this.ctx.override(this.nodeProto,"append",((t,e,[...r])=>{const o=new d({nodes:r},t,e);return this.emit("append",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.nodes)})),this.ctx.override(this.nodeProto,"appendChild",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({node:o},t,e);return this.emit("appendChild",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.node)}))}overrideBaseURI(){this.ctx.overrideDescriptor(this.nodeProto,"baseURI",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("baseURI",r),r.intercepted?r.returnValue:r.data.value}})}overrideParent(){this.ctx.overrideDescriptor(this.nodeProto,"parentNode",{get:(t,e)=>{const r=new d({node:t.call(e)},t,e);return this.emit("parentNode",r),r.intercepted?r.returnValue:r.data.node}}),this.ctx.overrideDescriptor(this.nodeProto,"parentElement",{get:(t,e)=>{const r=new d({element:t.call(e)},t,e);return this.emit("parentElement",r),r.intercepted?r.returnValue:r.data.node}})}overrideOwnerDocument(){this.ctx.overrideDescriptor(this.nodeProto,"ownerDocument",{get:(t,e)=>{const r=new d({document:t.call(e)},t,e);return this.emit("ownerDocument",r),r.intercepted?r.returnValue:r.data.document}})}overrideCompareDocumentPosit1ion(){this.ctx.override(this.nodeProto,"compareDocumentPosition",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({node:o},t,e);return s.intercepted?s.returnValue:s.target.call(s.that,s.data.node)}))}overrideChildMethods(){this.ctx.override(this.nodeProto,"removeChild")}},f=y,P=h(c(),1),x=class extends P.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Attr=this.window.Attr||{},this.attrProto=this.Attr.prototype||{},this.value=t.nativeMethods.getOwnPropertyDescriptor(this.attrProto,"value"),this.name=t.nativeMethods.getOwnPropertyDescriptor(this.attrProto,"name"),this.getNamedItem=this.attrProto.getNamedItem||null,this.setNamedItem=this.attrProto.setNamedItem||null,this.removeNamedItem=this.attrProto.removeNamedItem||null,this.getNamedItemNS=this.attrProto.getNamedItemNS||null,this.setNamedItemNS=this.attrProto.setNamedItemNS||null,this.removeNamedItemNS=this.attrProto.removeNamedItemNS||null,this.item=this.attrProto.item||null}overrideNameValue(){this.ctx.overrideDescriptor(this.attrProto,"name",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("name",r),r.intercepted?r.returnValue:r.data.value}}),this.ctx.overrideDescriptor(this.attrProto,"value",{get:(t,e)=>{const r=new d({name:this.name.get.call(e),value:t.call(e)},t,e);return this.emit("getValue",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({name:this.name.get.call(e),value:r},t,e);if(this.emit("setValue",o),o.intercepted)return o.returnValue;o.target.call(o.that,o.data.value)}})}overrideItemMethods(){this.ctx.override(this.attrProto,"getNamedItem",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("getNamedItem",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.attrProto,"setNamedItem",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,value:s},t,e);return this.emit("setNamedItem",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)})),this.ctx.override(this.attrProto,"removeNamedItem",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("removeNamedItem",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.attrProto,"item",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({index:o},t,e);return this.emit("item",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.attrProto,"getNamedItemNS",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({namespace:o,localName:s},t,e);return this.emit("getNamedItemNS",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.namespace,i.data.localName)})),this.ctx.override(this.attrProto,"setNamedItemNS",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({attr:o},t,e);return this.emit("setNamedItemNS",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.attrProto,"removeNamedItemNS",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({namespace:o,localName:s},t,e);return this.emit("removeNamedItemNS",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.namespace,i.data.localName)}))}},b=x,O=h(c(),1),S=class extends O.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Function=this.window.Function,this.fnProto=this.Function.prototype,this.toString=this.fnProto.toString,this.fnStrings=t.fnStrings,this.call=this.fnProto.call,this.apply=this.fnProto.apply,this.bind=this.fnProto.bind}overrideFunction(){this.ctx.override(this.window,"Function",((t,e,r)=>{if(!r.length)return t.apply(e,r);const o=r[r.length-1],s=[];for(let t=0;t<r.length-1;t++)s.push(r[t]);const i=new d({script:o,args:s},t,e);return this.emit("function",i),i.intercepted?i.returnValue:i.target.call(i.that,...i.data.args,i.data.script)}),!0)}overrideToString(){this.ctx.override(this.fnProto,"toString",((t,e)=>{const r=new d({fn:e},t,e);return this.emit("toString",r),r.intercepted?r.returnValue:r.target.call(r.data.fn)}))}},k=S,M=h(c(),1),D=class extends M.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Object=this.window.Object,this.getOwnPropertyDescriptors=this.Object.getOwnPropertyDescriptors,this.getOwnPropertyDescriptor=this.Object.getOwnPropertyDescriptor,this.getOwnPropertyNames=this.Object.getOwnPropertyNames}overrideGetPropertyNames(){this.ctx.override(this.Object,"getOwnPropertyNames",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({names:t.call(e,o)},t,e);return this.emit("getOwnPropertyNames",s),s.intercepted?s.returnValue:s.data.names}))}overrideGetOwnPropertyDescriptors(){this.ctx.override(this.Object,"getOwnPropertyDescriptors",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({descriptors:t.call(e,o)},t,e);return this.emit("getOwnPropertyDescriptors",s),s.intercepted?s.returnValue:s.data.descriptors}))}},L=D,V=h(c(),1),N=class extends V.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.fetch=this.window.fetch,this.Request=this.window.Request,this.Response=this.window.Response,this.Headers=this.window.Headers,this.reqProto=this.Request?this.Request.prototype:{},this.resProto=this.Response?this.Response.prototype:{},this.headersProto=this.Headers?this.Headers.prototype:{},this.reqUrl=t.nativeMethods.getOwnPropertyDescriptor(this.reqProto,"url"),this.resUrl=t.nativeMethods.getOwnPropertyDescriptor(this.resProto,"url"),this.reqHeaders=t.nativeMethods.getOwnPropertyDescriptor(this.reqProto,"headers"),this.resHeaders=t.nativeMethods.getOwnPropertyDescriptor(this.resProto,"headers")}override(){return this.overrideRequest(),this.overrideUrl(),this.overrideHeaders(),!0}overrideRequest(){return!!this.fetch&&(this.ctx.override(this.window,"fetch",((t,e,r)=>{if(!r.length||r[0]instanceof this.Request)return t.apply(e,r);const[o,s={}]=r,i=new d({input:o,options:s},t,e);return this.emit("request",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.input,i.data.options)})),this.ctx.override(this.window,"Request",((t,e,r)=>{if(!r.length)return new t(...r);const[o,s={}]=r,i=new d({input:o,options:s},t);return this.emit("request",i),i.intercepted?i.returnValue:new i.target(i.data.input,i.data.options)}),!0),!0)}overrideUrl(){return this.ctx.overrideDescriptor(this.reqProto,"url",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("requestUrl",r),r.intercepted?r.returnValue:r.data.value}}),this.ctx.overrideDescriptor(this.resProto,"url",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("responseUrl",r),r.intercepted?r.returnValue:r.data.value}}),!0}overrideHeaders(){return!!this.Headers&&(this.ctx.overrideDescriptor(this.reqProto,"headers",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("requestHeaders",r),r.intercepted?r.returnValue:r.data.value}}),this.ctx.overrideDescriptor(this.resProto,"headers",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("responseHeaders",r),r.intercepted?r.returnValue:r.data.value}}),this.ctx.override(this.headersProto,"get",((t,e,[r])=>{if(!r)return t.call(e);const o=new d({name:r,value:t.call(e,r)},t,e);return this.emit("getHeader",o),o.intercepted?o.returnValue:o.data.value})),this.ctx.override(this.headersProto,"set",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,value:s},t,e);return this.emit("setHeader",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)})),this.ctx.override(this.headersProto,"has",((t,e,r)=>{if(!r.length)return t.call(e);const[o]=r,s=new d({name:o,value:t.call(e,o)},t,e);return this.emit("hasHeader",s),s.intercepted?s.returnValue:s.data})),this.ctx.override(this.headersProto,"append",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,value:s},t,e);return this.emit("appendHeader",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)})),this.ctx.override(this.headersProto,"delete",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o},t,e);return this.emit("deleteHeader",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),!0)}},R=N,I=h(c(),1),E=class extends I.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.XMLHttpRequest=this.window.XMLHttpRequest,this.xhrProto=this.window.XMLHttpRequest?this.window.XMLHttpRequest.prototype:{},this.open=this.xhrProto.open,this.abort=this.xhrProto.abort,this.send=this.xhrProto.send,this.overrideMimeType=this.xhrProto.overrideMimeType,this.getAllResponseHeaders=this.xhrProto.getAllResponseHeaders,this.getResponseHeader=this.xhrProto.getResponseHeader,this.setRequestHeader=this.xhrProto.setRequestHeader,this.responseURL=t.nativeMethods.getOwnPropertyDescriptor(this.xhrProto,"responseURL"),this.responseText=t.nativeMethods.getOwnPropertyDescriptor(this.xhrProto,"responseText")}override(){this.overrideOpen(),this.overrideSend(),this.overrideMimeType(),this.overrideGetResHeader(),this.overrideGetResHeaders(),this.overrideSetReqHeader()}overrideOpen(){this.ctx.override(this.xhrProto,"open",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s,i=!0,n=null,a=null]=r,h=new d({method:o,input:s,async:i,user:n,password:a},t,e);return this.emit("open",h),h.intercepted?h.returnValue:h.target.call(h.that,h.data.method,h.data.input,h.data.async,h.data.user,h.data.password)}))}overrideResponseUrl(){this.ctx.overrideDescriptor(this.xhrProto,"responseURL",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("responseUrl",r),r.intercepted?r.returnValue:r.data.value}})}overrideSend(){this.ctx.override(this.xhrProto,"send",((t,e,[r=null])=>{const o=new d({body:r},t,e);return this.emit("send",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.body)}))}overrideSetReqHeader(){this.ctx.override(this.xhrProto,"setRequestHeader",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,value:s},t,e);return this.emit("setReqHeader",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)}))}overrideGetResHeaders(){this.ctx.override(this.xhrProto,"getAllResponseHeaders",((t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getAllResponseHeaders",r),r.intercepted?r.returnValue:r.data.value}))}overrideGetResHeader(){this.ctx.override(this.xhrProto,"getResponseHeader",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({name:o,value:t.call(e,o)},t,e);return s.intercepted?s.returnValue:s.data.value}))}},T=E,C=h(c(),1),A=class extends C.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.EventSource=this.window.EventSource||{},this.esProto=this.EventSource.prototype||{},this.url=t.nativeMethods.getOwnPropertyDescriptor(this.esProto,"url"),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2}overrideConstruct(){this.ctx.override(this.window,"EventSource",((t,e,r)=>{if(!r.length)return new t(...r);const[o,s={}]=r,i=new d({url:o,config:s},t,e);return this.emit("construct",i),i.intercepted?i.returnValue:new i.target(i.data.url,i.data.config)}),!0),"EventSource"in this.window&&(this.window.EventSource.CONNECTING=this.CONNECTING,this.window.EventSource.OPEN=this.OPEN,this.window.EventSource.CLOSED=this.CLOSED)}overrideUrl(){this.ctx.overrideDescriptor(this.esProto,"url",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("url",r),r.data.value}})}},j=A,H=h(c(),1),U=class extends H.default{constructor(t){super(),this.ctx=t,this.window=this.ctx.window,this.History=this.window.History,this.history=this.window.history,this.historyProto=this.History?this.History.prototype:{},this.pushState=this.historyProto.pushState,this.replaceState=this.historyProto.replaceState,this.go=this.historyProto.go,this.back=this.historyProto.back,this.forward=this.historyProto.forward}override(){this.overridePushState(),this.overrideReplaceState(),this.overrideGo(),this.overrideForward(),this.overrideBack()}overridePushState(){this.ctx.override(this.historyProto,"pushState",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s,i=""]=r,n=new d({state:o,title:s,url:i},t,e);return this.emit("pushState",n),n.intercepted?n.returnValue:n.target.call(n.that,n.data.state,n.data.title,n.data.url)}))}overrideReplaceState(){this.ctx.override(this.historyProto,"replaceState",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s,i=""]=r,n=new d({state:o,title:s,url:i},t,e);return this.emit("replaceState",n),n.intercepted?n.returnValue:n.target.call(n.that,n.data.state,n.data.title,n.data.url)}))}overrideGo(){this.ctx.override(this.historyProto,"go",((t,e,[r])=>{const o=new d({delta:r},t,e);return this.emit("go",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.delta)}))}overrideForward(){this.ctx.override(this.historyProto,"forward",((t,e)=>{const r=new d(null,t,e);return this.emit("forward",r),r.intercepted?r.returnValue:r.target.call(r.that)}))}overrideBack(){this.ctx.override(this.historyProto,"back",((t,e)=>{const r=new d(null,t,e);return this.emit("back",r),r.intercepted?r.returnValue:r.target.call(r.that)}))}},W=U,q=h(c(),1),_=class extends q.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.location=this.window.location,this.WorkerLocation=this.ctx.worker?this.window.WorkerLocation:null,this.workerLocProto=this.WorkerLocation?this.WorkerLocation.prototype:{},this.keys=["href","protocol","host","hostname","port","pathname","search","hash","origin"],this.HashChangeEvent=this.window.HashChangeEvent||null,this.href=this.WorkerLocation?t.nativeMethods.getOwnPropertyDescriptor(this.workerLocProto,"href"):t.nativeMethods.getOwnPropertyDescriptor(this.location,"href")}overrideWorkerLocation(t){if(!this.WorkerLocation)return!1;for(const e of this.keys)this.ctx.overrideDescriptor(this.workerLocProto,e,{get:()=>t(this.href.get.call(this.location))[e]});return!0}emulate(t,e){const r={},o=this;for(const s of o.keys)this.ctx.nativeMethods.defineProperty(r,s,{get:()=>t(o.href.get.call(o.location))[s],set:"origin"!==s?t=>{switch(s){case"href":o.location.href=e(t);break;case"hash":o.emit("hashchange",r.href,t.trim().startsWith("#")?new URL(t.trim(),r.href).href:new URL("#"+t.trim(),r.href).href,o);break;default:{const i=new URL(r.href);i[s]=t,o.location.href=e(i.href)}}}:void 0,configurable:!1,enumerable:!0});return"reload"in this.location&&this.ctx.nativeMethods.defineProperty(r,"reload",{value:this.ctx.wrap(this.location,"reload",((t,e)=>t.call(e===r?this.location:e))),writable:!1,enumerable:!0}),"replace"in this.location&&this.ctx.nativeMethods.defineProperty(r,"replace",{value:this.ctx.wrap(this.location,"assign",((t,o,s)=>{(!s.length||o!==r)&&t.call(o),o=this.location;const[i]=s,n=new URL(i,r.href);return t.call(o===r?this.location:o,e(n.href))})),writable:!1,enumerable:!0}),"assign"in this.location&&this.ctx.nativeMethods.defineProperty(r,"assign",{value:this.ctx.wrap(this.location,"assign",((t,o,s)=>{(!s.length||o!==r)&&t.call(o),o=this.location;const[i]=s,n=new URL(i,r.href);return t.call(o===r?this.location:o,e(n.href))})),writable:!1,enumerable:!0}),"ancestorOrigins"in this.location&&this.ctx.nativeMethods.defineProperty(r,"ancestorOrigins",{get(){const t=[];return o.window.DOMStringList&&o.ctx.nativeMethods.setPrototypeOf(t,o.window.DOMStringList.prototype),t},set:void 0,enumerable:!0}),this.ctx.nativeMethods.defineProperty(r,"toString",{value:this.ctx.wrap(this.location,"toString",(()=>r.href)),enumerable:!0,writable:!1}),this.ctx.nativeMethods.defineProperty(r,Symbol.toPrimitive,{value:()=>r.href,writable:!1,enumerable:!1}),this.ctx.window.Location&&this.ctx.nativeMethods.setPrototypeOf(r,this.ctx.window.Location.prototype),r}},B=_,F=h(c(),1),G=class extends F.default{constructor(t){super(),this.ctx=t,this.window=this.ctx.window,this.postMessage=this.window.postMessage,this.MessageEvent=this.window.MessageEvent||{},this.MessagePort=this.window.MessagePort||{},this.mpProto=this.MessagePort.prototype||{},this.mpPostMessage=this.mpProto.postMessage,this.messageProto=this.MessageEvent.prototype||{},this.messageData=t.nativeMethods.getOwnPropertyDescriptor(this.messageProto,"data"),this.messageOrigin=t.nativeMethods.getOwnPropertyDescriptor(this.messageProto,"origin")}overridePostMessage(){this.ctx.override(this.window,"postMessage",((t,e,r)=>{if(!r.length)return t.apply(e,r);let o,s,i;this.ctx.worker?[o,i=[]]=r:[o,s,i=[]]=r;const n=new d({message:o,origin:s,transfer:i,worker:this.ctx.worker},t,e);return this.emit("postMessage",n),n.intercepted?n.returnValue:this.ctx.worker?n.target.call(n.that,n.data.message,n.data.transfer):n.target.call(n.that,n.data.message,n.data.origin,n.data.transfer)}))}wrapPostMessage(t,e,r=!1){return this.ctx.wrap(t,e,((e,o,s)=>{if(this.ctx.worker?!s.length:2>s)return e.apply(o,s);let i,n,a;r?([i,a=[]]=s,n=null):[i,n,a=[]]=s;const h=new d({message:i,origin:n,transfer:a,worker:this.ctx.worker},e,t);return this.emit("postMessage",h),h.intercepted?h.returnValue:r?h.target.call(h.that,h.data.message,h.data.transfer):h.target.call(h.that,h.data.message,h.data.origin,h.data.transfer)}))}overrideMessageOrigin(){this.ctx.overrideDescriptor(this.messageProto,"origin",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("origin",r),r.intercepted?r.returnValue:r.data.value}})}overrideMessageData(){this.ctx.overrideDescriptor(this.messageProto,"data",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("data",r),r.intercepted?r.returnValue:r.data.value}})}},X=G,$=h(c(),1),K=class extends $.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.navigator=this.window.navigator,this.Navigator=this.window.Navigator||{},this.navProto=this.Navigator.prototype||{},this.sendBeacon=this.navProto.sendBeacon}overrideSendBeacon(){this.ctx.override(this.navProto,"sendBeacon",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o,s=""]=r,i=new d({url:o,data:s},t,e);return this.emit("sendBeacon",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.url,i.data.data)}))}},Q=K,z=h(c(),1),J=(globalThis.fetch,globalThis.SharedWorker),Y=globalThis.localStorage,Z=globalThis.navigator.serviceWorker,tt=MessagePort.prototype.postMessage;async function et(){const t=(await self.clients.matchAll({type:"window",includeUncontrolled:!0})).map((async t=>{const e=await(t=>{const e=new MessageChannel;return new Promise((r=>{t.postMessage({type:"getPort",port:e.port2},[e.port2]),e.port1.onmessage=t=>{r(t.data)}}))})(t);return await rt(e),e})),e=Promise.race([Promise.any(t),new Promise(((t,e)=>setTimeout(e,1e3,new TypeError("timeout"))))]);try{return await e}catch(t){if(t instanceof AggregateError)throw console.error("bare-mux: failed to get a bare-mux SharedWorker MessagePort as all clients returned an invalid MessagePort."),new Error("All clients returned an invalid MessagePort.");return console.warn("bare-mux: failed to get a bare-mux SharedWorker MessagePort within 1s, retrying"),await et()}}function rt(t){const e=new MessageChannel,r=new Promise(((t,r)=>{e.port1.onmessage=e=>{"pong"===e.data.type&&t()},setTimeout(r,1500)}));return tt.call(t,{message:{type:"ping"},port:e.port2},[e.port2]),r}function ot(t,e){const r=new J(t,"bare-mux-worker");return e&&Z.addEventListener("message",(e=>{if("getPort"===e.data.type&&e.data.port){console.debug("bare-mux: recieved request for port from sw");const r=new J(t,"bare-mux-worker");tt.call(e.data.port,r.port,[r.port])}})),r.port}WebSocket.prototype.send,WebSocket.CLOSED,WebSocket.CLOSING,WebSocket.CONNECTING,WebSocket.OPEN;var st=null,it=class{constructor(t){this.channel=new BroadcastChannel("bare-mux"),t instanceof MessagePort||t instanceof Promise?this.port=t:this.createChannel(t,!0)}createChannel(t,e){if(self.clients)this.port=et(),this.channel.onmessage=t=>{"refreshPort"===t.data.type&&(this.port=et())};else if(t&&SharedWorker){if(!t.startsWith("/")&&!t.includes("://"))throw new Error("Invalid URL. Must be absolute or start at the root.");this.port=ot(t,e),console.debug("bare-mux: setting localStorage bare-mux-path to",t),Y["bare-mux-path"]=t}else{if(!SharedWorker)throw new Error("Unable to get a channel to the SharedWorker.");{const t=Y["bare-mux-path"];if(console.debug("bare-mux: got localStorage bare-mux-path:",t),!t)throw new Error("Unable to get bare-mux workerPath from localStorage.");this.port=ot(t,e)}}}async sendMessage(t,e){this.port instanceof Promise&&(this.port=await this.port);try{await rt(this.port)}catch{return console.warn("bare-mux: Failed to get a ping response from the worker within 1.5s. Assuming port is dead."),this.createChannel(),await this.sendMessage(t,e)}const r=new MessageChannel,o=[r.port2,...e||[]],s=new Promise(((t,e)=>{r.port1.onmessage=r=>{const o=r.data;"error"===o.type?e(o.error):t(o)}}));return tt.call(this.port,{message:t,port:r.port2},o),await s}};function nt(t,e,r){console.error(`error while processing '${r}': `,e),t.postMessage({type:"error",error:e})}var at=class{constructor(t){this.worker=new it(t)}async getTransport(){return(await this.worker.sendMessage({type:"get"})).name}async setTransport(t,e,r){await this.setManualTransport(`\n\t\t\tconst { default: BareTransport } = await import("${t}");\n\t\t\treturn [BareTransport, "${t}"];\n\t\t`,e,r)}async setManualTransport(t,e,r){if("bare-mux-remote"===t)throw new Error("Use setRemoteTransport.");await this.worker.sendMessage({type:"set",client:{function:t,args:e}},r)}async setRemoteTransport(t,e){const r=new MessageChannel;r.port1.onmessage=async e=>{const r=e.data.port,o=e.data.message;if("fetch"===o.type)try{t.ready||await t.init(),await(async(t,e,r)=>{const o=await r.request(new URL(t.fetch.remote),t.fetch.method,t.fetch.body,t.fetch.headers,null);if(!function(){if(null===st){let t,e=new MessageChannel,r=new ReadableStream;try{tt.call(e.port1,r,[r]),t=!0}catch{t=!1}return st=t,t}return st}()&&o.body instanceof ReadableStream){const t=new Response(o.body);o.body=await t.arrayBuffer()}o.body instanceof ReadableStream||o.body instanceof ArrayBuffer?tt.call(e,{type:"fetch",fetch:o},[o.body]):tt.call(e,{type:"fetch",fetch:o})})(o,r,t)}catch(t){nt(r,t,"fetch")}else if("websocket"===o.type)try{t.ready||await t.init(),await(async(t,e,r)=>{const[o,s]=r.connect(new URL(t.websocket.url),t.websocket.protocols,t.websocket.requestHeaders,(e=>{tt.call(t.websocket.channel,{type:"open",args:[e]})}),(e=>{e instanceof ArrayBuffer?tt.call(t.websocket.channel,{type:"message",args:[e]},[e]):tt.call(t.websocket.channel,{type:"message",args:[e]})}),((e,r)=>{tt.call(t.websocket.channel,{type:"close",args:[e,r]})}),(e=>{tt.call(t.websocket.channel,{type:"error",args:[e]})}));t.websocket.channel.onmessage=t=>{"data"===t.data.type?o(t.data.data):"close"===t.data.type&&s(t.data.closeCode,t.data.closeReason)},tt.call(e,{type:"websocket"})})(o,r,t)}catch(t){nt(r,t,"websocket")}},await this.worker.sendMessage({type:"set",client:{function:"bare-mux-remote",args:[r.port2,e]}},[r.port2])}getInnerPort(){return this.worker.port}};console.debug("bare-mux: running v2.1.6 (build 4b7607b)");var ht=class extends z.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.Worker=this.window.Worker||{},this.Worklet=this.window.Worklet||{},this.workletProto=this.Worklet.prototype||{},this.workerProto=this.Worker.prototype||{},this.postMessage=this.workerProto.postMessage,this.terminate=this.workerProto.terminate,this.addModule=this.workletProto.addModule}overrideWorker(){this.ctx.override(this.window,"Worker",((t,e,r)=>{if(!r.length)return new t(...r);const[o,s={}]=r,i=new d({url:o,options:s},t,e);if(this.emit("worker",i),i.intercepted)return i.returnValue;const n=new i.target(i.data.url,i.data.options),a=new at;return(async()=>{const t=await a.getInnerPort();n.postMessage({__uv$type:"baremuxinit",port:t},[t])})(),n}),!0)}overrideAddModule(){this.ctx.override(this.workletProto,"addModule",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o,s={}]=r,i=new d({url:o,options:s},t,e);return this.emit("addModule",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.url,i.data.options)}))}overridePostMessage(){this.ctx.override(this.workerProto,"postMessage",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o,s=[]]=r,i=new d({message:o,transfer:s},t,e);return this.emit("postMessage",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.message,i.data.transfer)}))}overrideImportScripts(){this.ctx.override(this.window,"importScripts",((t,e,r)=>{if(!r.length)return t.apply(e,r);const o=new d({scripts:r},t,e);return this.emit("importScripts",o),o.intercepted?o.returnValue:o.target.apply(o.that,o.data.scripts)}))}},ct=ht,lt=h(c(),1),dt=class extends lt.default{constructor(t){super(),this.ctx=t,this.window=this.ctx.window,this.URL=this.window.URL||{},this.createObjectURL=this.URL.createObjectURL,this.revokeObjectURL=this.URL.revokeObjectURL}overrideObjectURL(){this.ctx.override(this.URL,"createObjectURL",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({object:o},t,e);return this.emit("createObjectURL",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.object)})),this.ctx.override(this.URL,"revokeObjectURL",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({url:o},t,e);return this.emit("revokeObjectURL",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.url)}))}},ut=dt,pt=h(c(),1),wt=h(c(),1),gt=class extends wt.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.localStorage=this.window.localStorage||null,this.sessionStorage=this.window.sessionStorage||null,this.Storage=this.window.Storage||{},this.storeProto=this.Storage.prototype||{},this.getItem=this.storeProto.getItem||null,this.setItem=this.storeProto.setItem||null,this.removeItem=this.storeProto.removeItem||null,this.clear=this.storeProto.clear||null,this.key=this.storeProto.key||null,this.methods=["key","getItem","setItem","removeItem","clear"],this.wrappers=new t.nativeMethods.Map}overrideMethods(){this.ctx.override(this.storeProto,"getItem",((t,e,r)=>{if(!r.length)return t.apply(this.wrappers.get(e)||e,r);const[o]=r,s=new d({name:o},t,this.wrappers.get(e)||e);return this.emit("getItem",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.storeProto,"setItem",((t,e,r)=>{if(2>r.length)return t.apply(this.wrappers.get(e)||e,r);const[o,s]=r,i=new d({name:o,value:s},t,this.wrappers.get(e)||e);return this.emit("setItem",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.value)})),this.ctx.override(this.storeProto,"removeItem",((t,e,r)=>{if(!r.length)return t.apply(this.wrappers.get(e)||e,r);const[o]=r,s=new d({name:o},t,this.wrappers.get(e)||e);return this.emit("removeItem",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.name)})),this.ctx.override(this.storeProto,"clear",((t,e)=>{const r=new d(null,t,this.wrappers.get(e)||e);return this.emit("clear",r),r.intercepted?r.returnValue:r.target.call(r.that)})),this.ctx.override(this.storeProto,"key",((t,e,r)=>{if(!r.length)return t.apply(this.wrappers.get(e)||e,r);const[o]=r,s=new d({index:o},t,this.wrappers.get(e)||e);return this.emit("key",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.index)}))}overrideLength(){this.ctx.overrideDescriptor(this.storeProto,"length",{get:(t,e)=>{const r=new d({length:t.call(this.wrappers.get(e)||e)},t,this.wrappers.get(e)||e);return this.emit("length",r),r.intercepted?r.returnValue:r.data.length}})}emulate(t,e={}){this.ctx.nativeMethods.setPrototypeOf(e,this.storeProto);const r=new this.ctx.window.Proxy(e,{get:(e,r)=>{if(r in this.storeProto||"symbol"==typeof r)return t[r];const o=new d({name:r},null,t);return this.emit("get",o),o.intercepted?o.returnValue:t[o.data.name]},set:(e,r,o)=>{if(r in this.storeProto||"symbol"==typeof r)return t[r]=o;const s=new d({name:r,value:o},null,t);return this.emit("set",s),s.intercepted?s.returnValue:t[s.data.name]=s.data.value},deleteProperty:(e,r)=>{if("symbol"==typeof r)return delete t[r];const o=new d({name:r},null,t);return this.emit("delete",o),o.intercepted?o.returnValue:delete t[o.data.name]}});return this.wrappers.set(r,t),this.ctx.nativeMethods.setPrototypeOf(r,this.storeProto),r}},mt=gt,vt=h(c(),1),yt=class extends vt.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.CSSStyleDeclaration=this.window.CSSStyleDeclaration||{},this.cssStyleProto=this.CSSStyleDeclaration.prototype||{},this.getPropertyValue=this.cssStyleProto.getPropertyValue||null,this.setProperty=this.cssStyleProto.setProperty||null,this.cssText,t.nativeMethods.getOwnPropertyDescriptors(this.cssStyleProto,"cssText"),this.urlProps=["background","backgroundImage","borderImage","borderImageSource","listStyle","listStyleImage","cursor"],this.dashedUrlProps=["background","background-image","border-image","border-image-source","list-style","list-style-image","cursor"],this.propToDashed={background:"background",backgroundImage:"background-image",borderImage:"border-image",borderImageSource:"border-image-source",listStyle:"list-style",listStyleImage:"list-style-image",cursor:"cursor"}}overrideSetGetProperty(){this.ctx.override(this.cssStyleProto,"getPropertyValue",((t,e,r)=>{if(!r.length)return t.apply(e,r);const[o]=r,s=new d({property:o},t,e);return this.emit("getPropertyValue",s),s.intercepted?s.returnValue:s.target.call(s.that,s.data.property)})),this.ctx.override(this.cssStyleProto,"setProperty",((t,e,r)=>{if(2>r.length)return t.apply(e,r);const[o,s]=r,i=new d({property:o,value:s},t,e);return this.emit("setProperty",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.property,i.data.value)}))}overrideCssText(){this.ctx.overrideDescriptor(this.cssStyleProto,"cssText",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("getCssText",r),r.intercepted?r.returnValue:r.data.value},set:(t,e,[r])=>{const o=new d({value:r},t,e);return this.emit("setCssText",o),o.intercepted?o.returnValue:o.target.call(o.that,o.data.value)}})}},ft=yt,Pt=h(c(),1),xt=class extends Pt.default{constructor(t){super(),this.ctx=t,this.window=this.ctx.window,this.IDBDatabase=this.window.IDBDatabase||{},this.idbDatabaseProto=this.IDBDatabase.prototype||{},this.IDBFactory=this.window.IDBFactory||{},this.idbFactoryProto=this.IDBFactory.prototype||{},this.open=this.idbFactoryProto.open}overrideOpen(){this.ctx.override(this.IDBFactory.prototype,"open",((t,e,r)=>{if(!r.length||!r.length)return t.apply(e,r);const[o,s]=r,i=new d({name:o,version:s},t,e);return this.emit("idbFactoryOpen",i),i.intercepted?i.returnValue:i.target.call(i.that,i.data.name,i.data.version)}))}overrideName(){this.ctx.overrideDescriptor(this.idbDatabaseProto,"name",{get:(t,e)=>{const r=new d({value:t.call(e)},t,e);return this.emit("idbFactoryName",r),r.intercepted?r.returnValue:r.data.value}})}},bt=xt,Ot=h(c(),1),St=class extends Ot.default{constructor(t){super(),this.ctx=t,this.window=t.window,this.WebSocket=this.window.WebSocket||{},this.wsProto=this.WebSocket.prototype,this.CONNECTING=WebSocket.CONNECTING,this.OPEN=WebSocket.OPEN,this.CLOSING=WebSocket.CLOSING,this.CLOSED=WebSocket.CLOSED,this.socketmap=new WeakMap}overrideWebSocket(t){this.ctx.override(this.window,"WebSocket",((e,r,o)=>{const s=new EventTarget;Object.setPrototypeOf(s,this.WebSocket.prototype),s.constructor=this.WebSocket;const i=t.createWebSocket(o[0],o[1],null,{"User-Agent":navigator.userAgent,Origin:__uv.meta.url.origin}),n={extensions:"",protocol:"",url:o[0],binaryType:"blob",barews:i};function a(t){n["on"+t.type]?.((t=>new Proxy(t,{get:(t,e)=>"isTrusted"===e||Reflect.get(t,e)}))(t)),s.dispatchEvent(t)}return i.addEventListener("open",(()=>{a(new Event("open"))})),i.addEventListener("close",(t=>{a(new CloseEvent("close",t))})),i.addEventListener("message",(async t=>{let e=t.data;"string"==typeof e||("byteLength"in e?"blob"===n.binaryType?e=new Blob([e]):Object.setPrototypeOf(e,ArrayBuffer.prototype):"arrayBuffer"in e&&"arraybuffer"===n.binaryType&&(e=await e.arrayBuffer(),Object.setPrototypeOf(e,ArrayBuffer.prototype))),a(new MessageEvent("message",{data:e,origin:t.origin,lastEventId:t.lastEventId,source:t.source,ports:t.ports}))})),i.addEventListener("error",(()=>{a(new Event("error"))})),this.socketmap.set(s,n),s}),!0),this.ctx.overrideDescriptor(this.wsProto,"binaryType",{get:(t,e)=>this.socketmap.get(e).binaryType,set:(t,e,r)=>{const o=this.socketmap.get(e);("blob"===r[0]||"arraybuffer"===r[0])&&(o.binaryType=r[0])}}),this.ctx.overrideDescriptor(this.wsProto,"bufferedAmount",{get:(t,e)=>0}),this.ctx.overrideDescriptor(this.wsProto,"extensions",{get:(t,e)=>this.socketmap.get(e).extensions}),this.ctx.overrideDescriptor(this.wsProto,"onclose",{get:(t,e)=>this.socketmap.get(e).onclose,set:(t,e,r)=>{this.socketmap.get(e).onclose=r[0]}}),this.ctx.overrideDescriptor(this.wsProto,"onerror",{get:(t,e)=>this.socketmap.get(e).onerror,set:(t,e,r)=>{this.socketmap.get(e).onerror=r[0]}}),this.ctx.overrideDescriptor(this.wsProto,"onmessage",{get:(t,e)=>this.socketmap.get(e).onmessage,set:(t,e,r)=>{this.socketmap.get(e).onmessage=r[0]}}),this.ctx.overrideDescriptor(this.wsProto,"onopen",{get:(t,e)=>this.socketmap.get(e).onopen,set:(t,e,r)=>{this.socketmap.get(e).onopen=r[0]}}),this.ctx.overrideDescriptor(this.wsProto,"url",{get:(t,e)=>this.socketmap.get(e).url}),this.ctx.overrideDescriptor(this.wsProto,"protocol",{get:(t,e)=>this.socketmap.get(e).protocol}),this.ctx.overrideDescriptor(this.wsProto,"readyState",{get:(t,e)=>this.socketmap.get(e).barews.readyState}),this.ctx.override(this.wsProto,"send",((t,e,r)=>this.socketmap.get(e).barews.send(r[0])),!1),this.ctx.override(this.wsProto,"close",((t,e,r)=>{const o=this.socketmap.get(e);return void 0===r[0]&&(r[0]=1e3),void 0===r[1]&&(r[1]=""),o.barews.close(r[0],r[1])}),!1)}},kt=St,Mt=class extends pt.default{constructor(t=self,e,r=!t.window){super(),this.window=t,this.nativeMethods={fnToString:this.window.Function.prototype.toString,defineProperty:this.window.Object.defineProperty,getOwnPropertyDescriptor:this.window.Object.getOwnPropertyDescriptor,getOwnPropertyDescriptors:this.window.Object.getOwnPropertyDescriptors,getOwnPropertyNames:this.window.Object.getOwnPropertyNames,keys:this.window.Object.keys,getOwnPropertySymbols:this.window.Object.getOwnPropertySymbols,isArray:this.window.Array.isArray,setPrototypeOf:this.window.Object.setPrototypeOf,isExtensible:this.window.Object.isExtensible,Map:this.window.Map,Proxy:this.window.Proxy},this.worker=r,this.bareClient=e,this.fetch=new R(this),this.xhr=new T(this),this.idb=new bt(this),this.history=new W(this),this.element=new m(this),this.node=new f(this),this.document=new p(this),this.function=new k(this),this.object=new L(this),this.websocket=new kt(this),this.message=new X(this),this.navigator=new Q(this),this.eventSource=new j(this),this.attribute=new b(this),this.url=new ut(this),this.workers=new ct(this),this.location=new B(this),this.storage=new mt(this),this.style=new ft(this)}override(t,e,r,o){const s=this.wrap(t,e,r,o);return t[e]=s,s}overrideDescriptor(t,e,r={}){const o=this.wrapDescriptor(t,e,r);return o?(this.nativeMethods.defineProperty(t,e,o),o):{}}wrap(t,e,r,o=!1){const s=t[e];if(!s)return s;const i="prototype"in s?function(){return r(s,this,[...arguments])}:{attach(){return r(s,this,[...arguments])}}.attach;return o&&(i.prototype=s.prototype,i.prototype.constructor=i),this.emit("wrap",s,i,o),i}wrapDescriptor(t,e,r={}){const o=this.nativeMethods.getOwnPropertyDescriptor(t,e);if(!o)return!1;for(const t in r)t in o&&(o[t]="get"===t||"set"===t?this.wrap(o,t,r[t]):"function"==typeof r[t]?r[t](o[t]):r[t]);return o}};"object"==typeof self&&(self.UVClient=Mt)})();